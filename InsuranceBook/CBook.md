---
title: "化险为夷——与复杂性和波动性共舞的艺术"
author: "广予"
date: "2022年11月26日"
description: "This is book about insurance history, technology and philosophy"
github-repo: "rstudio/bookdown-demo"
cover-image: "images/cover.png"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
classoption: oneside
biblio-style: apa
bibliography: [mybib.bib]
link-citations: yes
---



# 前言 {-}













<!--chapter:end:index.Rmd-->

# 保险科技中的模型风险管理与利用（一）：有德之才
从创业公司到保险巨头工作一年多了，今年写这个系列是因为深刻感觉到大语言模型会带来翻天覆地的工作范式与组织结构转变。
同时也希望把自己对保险这个古老生意以及背后的合约理论、期权交易和肥尾分布的概率模型的心得分享给大家。

将者，智、信、仁、勇、严也。在品德与才能的选择上，每当选择有才无德的人合作或者自己把所谓的才能优先级置于品德之上，都会尝到苦果，无一例外。
即使团队里的新手才能一开始有所欠缺，良好的品德会让他的成长迅速。如果你发现一个团队中充斥了以下这些文化觅母，战斗力起码不会弱。

比如，谦虚。谦虚的工程师会知道大型应用人工智能项目的复杂度以及自己作为人类理性的局限。所以他会
+ 主动谋求队友的批评与检查
+ 缩短反馈回路
+ 遵循已经被证明的最佳实践
+ 面向问题而不是执行细节编程(Program into interface instead of implementation details)。

比如，诚实。诚实的队友在犯错的第一时间会承认错误，内化，提供解决方案，并想着如何从错误中丰富自己的经验，在下次从错误中获利。
相反，不诚实的队友会和你说这一切都是天气不好或者老板的某个阴谋。知错能改，善莫大焉。

比如，好奇。在日新月异的应用人工智能领域，好奇的队友如果在工作中觉察到了自己在重复自己，他会感到深深的不满。
如果他感到自己一直在做紧急而不重要的事，只在做行为改变而不是结构调整，他会抗议。他的好奇会促使他：
+ 动手做实验。发现最适合当下自己的开发模式。
+ 阅读如何解决问题和认知科学相关的元知识。
+ 他始终好奇同样的任务有没有更好的解决方案。

比如，纪律。纪律非但是降低错误率的手段，也是创造力的来源。乔布斯说过，创新是对一千件事情说不，只有纪律和给自己约束，精力才能在重大的创新上燃烧。知止而后能定。为自己的工作制定纪律，比如：测试驱动开发、重构、写短小的模块化的函数、用简单的设计，似乎是给自己上了枷锁，但其实打开了创造力的大门。

比如，乐于合作。己所不欲勿施于人，他不会直接把一团乱麻的代码交给同事去修改。对一个工程师而言，他会把代码的可读性置于很高的优先级。对自己踩过的坑，他会及时把解决方案写在公共文档里。

<!--chapter:end:0101-usage.Rmd-->

# 量才胜己——保险科技的团队文化建设 
将者，智、信、仁、勇、严也。在品德与才能的选择上，每当选择有才无德的人合作或者自己把所谓的才能优先级置于品德之上，都会尝到苦果，无一例外。团队里的新手才能一开始有所欠缺，良好的品德会让他的成长迅速。如果你发现一个团队中充斥了以下这些文化觅母，战斗力起码不会弱。

比如，谦虚。谦虚的工程师会知道大型应用人工智能项目的复杂度以及自己作为人类理性的局限。所以他会

+ 主动谋求队友的批评与检查
+ 缩短反馈回路
+ 遵循已经被证明的最佳实践
+ 面向问题而不是执行细节编程(Program into interface instead of implementation details)。

比如，诚实。诚实的队友在犯错的第一时间会承认错误内化，及时止损。他会提供解决方案，并想着如何从错误中丰富自己的经验，在下次从错误中获利。
相反，不诚实的队友会和你说这一切都是天气不好或者老板的某个阴谋。知错能改，善莫大焉。

比如，好奇。在日新月异的应用人工智能领域，好奇的队友如果在工作中觉察到了自己在重复自己，他会感到深深的不满。如果他感到自己一直在做紧急而不重要的事，只在做行为改变而不是结构调整，他会抗议。他的好奇会促使他：

+ 动手做实验。发现最适合当下自己的开发模式。
+ 阅读如何解决问题和认知科学相关的元知识。
+ 他始终好奇同样的任务有没有更好的解决方案。

比如，纪律。纪律非但是降低错误率的手段，也是创造力的来源。乔布斯说过，创新是对一千件事情说不，只有纪律和给自己约束，精力才能在重大的创新上燃烧。
知止而后能定。为自己的工作制定纪律，比如：测试驱动开发、重构、写短小的模块化的函数、用简单的设计，似乎是给自己上了枷锁，但其实打开了创造力的大门。

比如，乐于合作。己所不欲勿施于人，他不会直接把一团乱麻的代码交给同事去修改。对一个优秀工程师而言，代码是写给人看的，接着才是机器执行的。对自己踩过的坑，他会及时把解决方案写在公共文档里。



<!--chapter:end:1001-chapter01.Rmd-->

# 保险科技中的认知偏差——模型风险与风险模型

风险模型与模型风险是极容易被混淆的两个概念。大模型当道，人们的注意力太多时候转向了分析模型揭示的近期、显性的风险，从而忽略了远期的、阴性的、过分依赖模型带来的风险。

模型风险不是说我们的模型不能发现未来不可预测的事，市场上大多数人都不行，人类历史就是不可预测跳变的。模型风险是指可预测逻辑上必然发生的事，由于我们过度依赖模型，我们认为它们离发生还很远。

师法自然，用模型进攻而不是防守。用模型产生数据而不是分析数据。防守主要是靠冗余。
当系统中建筑进一定的冗余度而非过分天真优化时，才能不被空头挤压(short squeeze)。

在实践而不是理论领域，或许我们应该遵循反向奥卡姆剃刀原则。
在理论中，多个竞争模型如果都能解释和预测数据，我们选择最简单的那个。
但是在实践中，尤其是风险管理生意如保险或期权，多种策略如果都能达到目标，我们选冗余最多的那个。天知道，一觉醒来，明天又会发生什么。

在实践中，如果经验与模型不一致时，左派书呆子会强行扭曲经验来适应模型。右派业务员可能会扭曲模型来适应经验。但其实两者可能都出错了，模型也错了，经验也错了。这时候需要重新判断更新行为和认知框架。


<!--chapter:end:2002-chapter02.Rmd-->

# 反向保险公司与圣彼得堡悖论

故事要从1713年的巴塞尔说起，尼古拉斯·伯努利（Nikolaus Bernoulli）问你假如抛一次硬币朝上，你赢2块钱，如果反面，继续游戏，第二次硬币朝上，你赢4块钱，如果反面，继续游戏，以此类推，第n次硬币朝上，你赢2的n次方块钱。请问你愿意出多少钱参加这个游戏？

这个问题的悖论之处在于即使你知道它的期望是正无穷，你也不会花很多钱参加这个游戏。

如果我们进一步简化这个问题，把它改成更简洁的掷筛子问题：
如果筛子为1，你赢1块钱，如果筛子为2，你赢2块钱，
如果筛子为3，你赢6块钱，如果筛子为4，你赢22块钱，
如果筛子为5，你赢200块钱，如果筛子为6，你赢1,000,000块钱。
请问你愿意出多少钱参加这个游戏？

显然你不会出500，000块去博1,000,000块的奖金，因为你知道很有可能你会扔到1，输掉499，999的钱。

1738年，丹尼尔伯努利（Daniel Bernoulli）提出了解决这个悖论的三个核心洞见：

- 每个人的资源都是有限的，他的本金与风险承受能力是有限的。
- 金钱带给人的边际效用递减。这里他提出了核心概念边际效用。
- 人们不能买未来还没被卖的机会。时间概率与集合概率之间有区别。

假设你有100,000元的本金，我们可以模拟各种付出的数量，并且计算六种情况下游戏结束以后你最终财富的几何平均期望。
假设你花50,000参与游戏为例，最终的几何期望收益就是(50001*50002*50006*50022*50200*10050000) ** 1/6 =56624元远远低于你原来的100,000元。

这个版本的圣彼得保悖论告诉我们如果从几何期望而不是算术期望的角度来看待问题，我们就能解开这个悖论。

下面我们在来思考圣彼得堡悖论的另一个版本，这与保险公司的生意有关。

假设你是一个大航海时代的船长，你有本金3000元，如果跑成一单货你会获得13000元的收入，净赚10000元。
但是大海上海盗林立，强匪横行，你的船有5%的概率被劫持，这会导致你承受10000元的损失。你在考虑要不要买保险？
保险公司给你开出的条件是，你交800元的保费，如果你的船被劫持，保险公司会给你赔偿10000元。

你算了一下觉得保险公司太黑心，为数学期望站在了它们一边：
-800 * 0.95 + (10000 - 800) * 0.05 = -300

或许你的内心还会嘀咕，这完全就是一个兜售恐惧的生意。

但是如果你从几何期望的角度来看待问题，你会发现购买了这个合同，在这个案例中，你与保险公司达成了正和博弈而非零和博弈。

如果不买保险，站在你的角度几何期望的计算就变成了：
((13000^95) * (3000^5))^1/100）= 12081元

如果你买了保险，你的最差收益就是13000-800 = 122000元。从几何期望的角度考虑，你收益了119元。

如果你是希望长期在这个运输行业立足，进行多轮博弈，你的目标是最大化你的年化增长率(compound annual growth rate)
而不是某个臆想出来的数学期望(mathematical expectation)。在这种情况下，在你的组合中加入保险公司的保险合同，是一个
成本有效(cost effective)的选择。

我们跳出航海时代，回到1955年的现实世界，那一年克拉默提出了保险生意的两个基本问题：

- 如何计算保险公司破产的概率？
- 如何刻画理赔总量的分布？
他写下了以下公式来描述：
U(t) = U + c(t) - S(t)
其中，U是公司的初始本金(initial capital)，c(t)代表保费收入率，S(t)是保单到达的过程。

从这个公式出发，我们可以得到两种不同的赚钱策略：
第一种策略是几乎每次都能赚钱，赚取稳定的保费，并确保黑天鹅事件带来的损失不会超过之前保费的总收入。

第二种策略更像是反向保险公司策略，它反其道而行之，它通过高频的小额的局部的损失来换取巨大的收益。这种策略被以塔勒布、马克·斯匹兹纳戈等人发挥地炉火纯青。
他们称自己为危机狩猎者(Crisis hunter)。

第一种策略更像是赌场盈利的策略，第二种是赌徒利用赌场对小概率时间带来的影响系统性低估而盈利的策略，它们互为其根。

第二种策略要求人在心理上不断地经历“将欲取之必先予之”的过程，有很强的反直觉性，本文所做的工作就是直追它诞生的历史冒险源头和思想源头
1713年的圣彼得堡悖论与波澜壮阔但是残酷血腥的大航海时代。

<!--chapter:end:3003-chapter03.Rmd-->

不可胜在己的编码与交易风险管理
孙子曰：善战者，先为不可胜，以待敌之可胜。不可胜在己，可胜在敌。同样，1903年瑞士精算学家Flip Lundberg提出了“毁灭问题”。在考虑如何盈利前，我们应该先考虑破产的风险。破产问题是指，假设你有一笔初始本金，客户的索赔率以服从泊松过程的强度到达，
你收一个常熟项的保费(preimum rate)，如何计算你开的公司破产的概率？

带着这个思维框架，去重新思考编码与交易，我们获得一种新的角度：
给定一笔本金，假设市场上每个到期的合约以服从某个过程的强度到达，我们如何计算交易破产的概率？
给定一个交付日期，假设不停变化的要求以服从某个过程的强度到达，我们如何计算项目无法交付的概率？

在这种角度下，我们不在关注市场与客户需求的变化怎样影响我们的盈利，而是关注我们对持续变化的反应是怎样影响我们的盈利。如果没有风险管理协议的设计与执行，从长期来看(甚至不用多长几天和几周就能看出来)，自己爆炸和破产都是注定的事。

## 交易风险管理

交易风险管理可以从交易前，交易中和交易后三个角度考虑。每笔交易，都是迈入一场残酷的战争，
在迈入战争前，我们需要问自己以下四个问题：
- 我的风险/收益比、几何期望收益与目标盈利是多少？
- 我能承受的最大损失是多少？
- 我即将开始的交易是为了赚钱还是为了管理风险，还是牺牲其中一个来换取另一个？

在交易中，我们需要问自己以下三个问题：
- 交易是否达到了我们之前制定的最大损失？
- 交易是否达到了我们之前制定的目标盈利？
- 我们是否值得冒险，让交易继续下去？

在交易后，我们需要复盘，问自己以下两个问题：
- 我自己是否遵守了风险管理协议？
- 如果没有，我为什么没有遵守？

兵法：一曰度，二曰量，三曰数，四曰称，五曰胜。在资源管理上，头寸管理与强行止损也是需要养成的肌肉记忆。在每笔交易中，不要冒超过2%的风险，如果在某两周或者一个月内，你的账户亏损超过6%，那么就停止交易，直到下一个月。这会防止你的两种死法：

1. 犯系统性的错误而不自知，不停地流血，一错再错，进入死亡循环。
2. 某一单出现巨额亏损，直接爆炸。

## 编码风险管理

如果把每一次的编程都当成是我们碳基大脑与硅基大脑的交易，那我们也可以将风险管理的原则与编程手艺的最佳实践结合起来。

下表展示了风险管理策略与测试驱动开发原则的对应关系：

|风险管理策略|实例|测试驱动开发原则|
|----------|----------|----------|
|分摊|两次下注$5000，而不是一次下注$10000|从测试——编码——重构三个正交的维度去解决一个问题而不是从一个维度去解决一个问题|
|多样化|两个人各下注$5000，而不是一个人下注$10000|单元测试需要正交且互相独立，最大程度上减少依赖|
|止损|不要冒超过2%的风险，如果在某两周或者一个月内，你的账户亏损超过6%，那么就停止交|一旦测试出错，就删去对应的生产代码，大脑退回到上一个状态中重新思考|

如果没有测试驱动开发，你就很难重构以及持续集成和持续交付。在交易中，你每晚都会平仓，因为你不想冒你无法管理的风险。
在编码中，你希望所有的编码改变都能客户具体的反馈。

## 推荐书目与核心概念
1. 破产问题、风险管理、测试驱动开发
2. Mandelbrot, Benoit, and Richard L. Hudson. The Misbehavior of Markets: A fractal view of financial turbulence. Basic books, 2007.
3. Beck, K. (2003). Test-driven development: by example. Addison-Wesley Professional.
4. Martin, R. C. (2011). The clean coder: a code of conduct for professional programmers. Pearson Education.
5. 孙武, & 郭化若. (1900). 孙子兵法--. BEIJING BOOK CO. INC..

<!--chapter:end:4004-chapter04.Rmd-->

# 切勿赢了概率输了赌局
如果把每一笔交易都当成一场战争，那么在投入到血雨腥风之前，
我们必须先算好自己的获胜概率与下注的金额(dosage or betting ratio)，否则就容易赢了概率输了赌局。
但如果我们的下注比例调整准确则可以如爱德华.索普(Edward Thorp)说的那样用庄家的钱赚钱。
曹操批孙子兵法有云：“故战必先算其费，因粮于敌也。”
1992年，爱德华.索普与Louis Rotando联合发表了凯利判据(Kelly Criterion)是如何应用于股票市场的资源分配问题的。

### 凯利判据的核心思想
假设你有一笔初始资金，你和庄家对赌，庄家拥有远大于你的接近无限的本金，但是设你用演绎法获得了一些信息优势。
每次赌局，你获胜的概率是0.7，而庄家获胜的概率是0.3。现在问你每笔赌局你应该下注多少，才能最大化你的收益，同时避免赌徒毁灭的困局。

爱德华.索普创造性地调整了优化的指标，既不是最小化毁灭的概率E(x0->0)，而不是最大化收益E(xn),而是最大化资本增长率对数转化下的几何平均
而非算术平均即E(log(xn/x0)^1/n)。如果我们要使得该值最大，那么每次下注的比例就是b - q/p，其中b是你潜在的获利除以你需要付出的成本，
p是你获胜的概率，q是你输的概率。

### 凯利判据与等加速运动和信息论类比
如果从信息论的视角去观察凯利希望最优化的增长率指数公式我们会发现它与香农信息熵公式的构造有惊人的相似。
香农信息熵公式为H(x) = -∑p(x)log(p(x))。香农信息熵提出的背景是在一个数据通信系统中，
假如我们有信息源，有通信渠道和接受者，如果一个系统完全没有背景噪音，那么信号可能丢失或损失，假如噪音太大
信号的传导不是最优的，所以我们需要找到一个合适的平衡点。

如果从物理运动视角去观察凯利判据，我们以下注的比例f为x轴，G(f)对数几何平均增长率为y轴，
我们会发现它与物理等加速运动的轨迹有惊人的相似。一旦下注比例超过了最优值，dy/dt速度就会变成负数。

### 凯利判据 vs 现代投资组合理论
现代投资理论假设资产的收益率服从正态分布，并且对基于历史数据的协方差矩阵的参数估计准确性要求很高。
它假设你对所有资产的联合概率分布有一个很好的估计，但是在实际中，我们很难得到这样的估计。相反，如果我们
在实践中使用凯利判据，我们要做的是不断根据最坏情况和期望收益的比例动态调整我们的下注比例，在投资组合的配比领域，
凯利判据相比于现代投资组合理论或许有更好的抗模型风险能力。如我们在第二篇文章讨论的，模型风险与风险模型
是两个截然不同但是容易混淆的概念。
 
## 推荐书目与核心概念
1. Thorp, E. O. (2008). The Kelly criterion in blackjack sports betting, and the stock market. In Handbook of asset and liability management (pp. 385-428). North-Holland.
2. Shannon, C. E. (1948). A mathematical theory of communication. The Bell system technical journal, 27(3), 379-423.

<!--chapter:end:5005-chapter05.Rmd-->

